// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ===================================
// User Management
// ===================================

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  avatar        String?
  role          UserRole  @default(CUSTOMER)
  isVerified    Boolean   @default(false)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  bookings      Booking[]
  reviews       Review[]
  favorites     Favorite[]

  @@map("users")
}

enum UserRole {
  CUSTOMER
  ADMIN
  HOTEL_MANAGER
}

// ===================================
// Hotel Management
// ===================================

model Hotel {
  id            String    @id @default(uuid())
  name          String
  description   String    @db.Text
  address       String
  city          String
  country       String
  zipCode       String?
  latitude      Float?
  longitude     Float?
  phone         String
  email         String
  website       String?
  checkInTime   String    @default("14:00")
  checkOutTime  String    @default("12:00")
  rating        Float     @default(0)
  totalReviews  Int       @default(0)
  images        String[]
  amenities     String[]  // ["WiFi", "Pool", "Gym", "Restaurant", "Parking"]
  policies      Json?     // JSON object for hotel policies
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  rooms         Room[]
  reviews       Review[]
  favorites     Favorite[]

  @@map("hotels")
}

// ===================================
// Room Management
// ===================================

model Room {
  id            String      @id @default(uuid())
  hotelId       String
  name          String
  description   String      @db.Text
  roomType      RoomType
  pricePerNight Float
  maxGuests     Int
  bedType       String      // "King", "Queen", "Twin", "Single"
  quantity      Int         @default(1) // จำนวนห้องประเภทนี้
  size          Float?      // ขนาดห้อง (ตารางเมตร)
  images        String[]
  amenities     String[]    // ["TV", "Mini Bar", "Balcony", "Sea View"]
  isAvailable   Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  hotel         Hotel       @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  bookings      Booking[]
  roomPricing   RoomPricing[]

  @@map("rooms")
}

enum RoomType {
  STANDARD
  DELUXE
  SUITE
  FAMILY
  PRESIDENTIAL
}

// ===================================
// Dynamic Pricing (Optional)
// ===================================

model RoomPricing {
  id            String    @id @default(uuid())
  roomId        String
  startDate     DateTime
  endDate       DateTime
  pricePerNight Float
  createdAt     DateTime  @default(now())

  // Relations
  room          Room      @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("room_pricing")
}

// ===================================
// Booking Management
// ===================================

model Booking {
  id              String        @id @default(uuid())
  userId          String
  roomId          String
  checkInDate     DateTime
  checkOutDate    DateTime
  numberOfGuests  Int
  numberOfNights  Int
  totalPrice      Float
  status          BookingStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  specialRequests String?       @db.Text
  cancellationReason String?    @db.Text
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  user            User          @relation(fields: [userId], references: [id])
  room            Room          @relation(fields: [roomId], references: [id])
  payment         Payment?

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
}

// ===================================
// Payment Management
// ===================================

model Payment {
  id              String        @id @default(uuid())
  bookingId       String        @unique
  amount          Float
  paymentMethod   String        // "Credit Card", "Bank Transfer", "Cash"
  transactionId   String?       @unique
  status          PaymentStatus @default(PENDING)
  paidAt          DateTime?
  createdAt       DateTime      @default(now())

  // Relations
  booking         Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// ===================================
// Review & Rating
// ===================================

model Review {
  id          String    @id @default(uuid())
  userId      String
  hotelId     String
  rating      Int       // 1-5
  comment     String    @db.Text
  images      String[]  // รูปภาพรีวิว
  isVerified  Boolean   @default(false) // ยืนยันว่าเคยพักจริง
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  user        User      @relation(fields: [userId], references: [id])
  hotel       Hotel     @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

// ===================================
// Favorite/Wishlist
// ===================================

model Favorite {
  id          String    @id @default(uuid())
  userId      String
  hotelId     String
  createdAt   DateTime  @default(now())

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotel       Hotel     @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@unique([userId, hotelId])
  @@map("favorites")
}
